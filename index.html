<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Roofy Presale - Shiba Dino-Dog Token</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js for pie chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Mobile optimization */
        html { -webkit-text-size-adjust: 100%; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(to bottom, #fffbeb 0%, #fed7aa 100%) !important;
        }
        .gradient-text { background: linear-gradient(to right, #f97316, #dc2626); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-bg { background: linear-gradient(135deg, #f97316 0%, #dc2626 100%); }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .wallet-connected { background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important; }
        
        /* Better mobile touch targets */
        button, input, .touch-target {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Fix for Phantom mobile deep linking */
        .phantom-deep-link {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #AB9FF2 0%, #7B61FF 100%);
            color: white;
            border-radius: 12px;
            text-decoration: none;
            font-weight: bold;
            margin: 10px 0;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .mobile-stack { flex-direction: column !important; }
            .mobile-text-center { text-align: center !important; }
            .mobile-p-4 { padding: 1rem !important; }
            .mobile-text-3xl { font-size: 1.875rem !important; }
            .mobile-text-4xl { font-size: 2.25rem !important; }
            .mobile-grid-cols-1 { grid-template-columns: 1fr !important; }
            .mobile-hidden { display: none !important; }
            .mobile-block { display: block !important; }
        }
        
        /* Custom scrollbar for mobile */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #fed7aa; }
        ::-webkit-scrollbar-thumb { background: #f97316; border-radius: 3px; }
        
        /* Token image styling */
        .token-image-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(249, 115, 22, 0.1);
            border: 3px solid #f97316;
        }
        
        .token-image {
            width: 100%;
            height: auto;
            border-radius: 15px;
            object-fit: cover;
        }
        
        /* Force light theme for Phantom */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(to bottom, #fffbeb 0%, #fed7aa 100%) !important;
                color: #1f2937 !important;
            }
            .bg-white {
                background-color: white !important;
            }
            .text-gray-700, .text-gray-600, .text-gray-500 {
                color: #4b5563 !important;
            }
        }
        
        /* Story section styling */
        .story-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(249, 115, 22, 0.1);
            border: 2px solid #f97316;
            transition: transform 0.3s ease;
        }
        
        .story-card:hover {
            transform: translateY(-5px);
        }
        
        .story-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-bottom: 20px;
        }
        
        .story-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .story-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #f97316, #dc2626);
        }
        
        .story-item {
            position: relative;
            padding-bottom: 30px;
        }
        
        .story-item:last-child {
            padding-bottom: 0;
        }
        
        .story-item::before {
            content: '';
            position: absolute;
            left: -33px;
            top: 5px;
            width: 12px;
            height: 12px;
            background: #f97316;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #f97316;
        }
        
        /* Error message styling */
        .error-message {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
            max-width: 100%;
            overflow-wrap: break-word;
            word-break: break-word;
        }
        
        .error-message pre {
            white-space: pre-wrap;
            font-size: 12px;
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 6px;
            margin-top: 8px;
            overflow-x: auto;
        }
        
        /* Balance display */
        .balance-display {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            margin-top: 5px;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-amber-50 to-orange-50 min-h-screen">
    <!-- Mobile Navigation -->
    <nav class="bg-white/95 backdrop-blur-sm border-b border-orange-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <!-- Replace this with your token logo -->
                <img src="https://chocolate-solid-skunk-453.mypinata.cloud/ipfs/bafkreigq22tzxessrj6mvdfcgw4xchwxcphvbbblrylwfunr2w63nhq7xq" alt="Roofy Logo" class="w-10 h-10 rounded-full">
                <div>
                    <h1 class="text-xl font-bold gradient-text mobile-hidden">ROOFY</h1>
                    <p class="text-xs text-gray-500 mobile-hidden">The Shiba Dino-Dog</p>
                </div>
            </div>
            <div class="flex items-center space-x-3">
                <button id="mobileMenu" class="md:hidden text-gray-700">
                    <i class="fas fa-bars text-xl"></i>
                </button>
                <button id="connectWallet" class="gradient-bg text-white px-4 py-2 rounded-full font-semibold text-sm md:px-6 md:py-3 md:text-base">
                    <i class="fas fa-wallet mr-2"></i><span class="mobile-hidden">Connect</span>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobileMenuContent" class="md:hidden bg-white border-t border-orange-200 hidden">
            <div class="px-4 py-3 space-y-3">
                <a href="#presale" class="block text-gray-700 hover:text-orange-600 font-medium py-2">Presale</a>
                <a href="#token" class="block text-gray-700 hover:text-orange-600 font-medium py-2">Token</a>
                <a href="#story" class="block text-gray-700 hover:text-orange-600 font-medium py-2">Story</a>
                <a href="#tokenomics" class="block text-gray-700 hover:text-orange-600 font-medium py-2">Tokenomics</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="py-8 md:py-12 px-4">
        <div class="max-w-6xl mx-auto">
            <!-- Live Banner -->
            <div class="gradient-bg rounded-2xl p-3 md:p-4 text-white text-center mb-6 pulse">
                <div class="flex items-center justify-center">
                    <div class="w-2 h-2 bg-white rounded-full mr-2 md:mr-3 animate-pulse"></div>
                    <span class="font-bold text-sm md:text-lg">ðŸš€ PRESALE IS LIVE! 50% Bonus for First 500 SOL</span>
                </div>
            </div>

            <div class="text-center mb-8">
                <!-- Hero Token Image -->
                <div class="token-image-container max-w-md mx-auto mb-6">
                    <img src="https://chocolate-solid-skunk-453.mypinata.cloud/ipfs/bafkreigq22tzxessrj6mvdfcgw4xchwxcphvbbblrylwfunr2w63nhq7xq" 
                         alt="Roofy Token" 
                         class="token-image">
                </div>
                
                <h1 class="text-3xl md:text-5xl lg:text-7xl font-bold mb-4 md:mb-6">
                    Meet <span class="gradient-text">Roofy</span>
                </h1>
                <p class="text-base md:text-xl text-gray-700 max-w-2xl mx-auto mb-6 md:mb-8">
                    The Shiba Inu who became a dinosaur to make a little girl smile. 
                    Now he lives forever on Solana.
                </p>
                
                <!-- Token Address Display -->
                <div class="max-w-2xl mx-auto bg-white/80 backdrop-blur-sm rounded-2xl p-4 md:p-6 border border-orange-200 mb-6">
                    <h3 class="font-bold text-lg mb-2"><i class="fas fa-fingerprint mr-2"></i>Token Address</h3>
                    <div class="flex flex-col md:flex-row items-center justify-between">
                        <div class="bg-gradient-to-r from-orange-100 to-amber-100 px-6 py-4 rounded-lg w-full md:w-auto mb-4 md:mb-0">
                            <div class="text-xl font-bold text-center text-gray-800">
                                ðŸš€ COMING SOON ðŸš€
                            </div>
                            <p class="text-sm text-gray-600 text-center mt-1">
                                Token address will be revealed after presale
                            </p>
                        </div>
                        <button onclick="copyTokenAddress()" class="px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 text-white rounded-lg hover:from-orange-600 hover:to-red-600 transition-all shadow-lg hover:shadow-xl font-bold">
                            <i class="fas fa-copy mr-2"></i>Copy
                        </button>
                    </div>
                </div>
            </div>

            <!-- Presale Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 mb-8 md:mb-12">
                <div class="bg-white rounded-xl md:rounded-2xl p-4 shadow-lg border border-orange-200 text-center">
                    <div class="text-xl md:text-3xl font-bold gradient-text" id="totalRaised">0</div>
                    <div class="text-xs md:text-gray-600">Total Raised (SOL)</div>
                </div>
                <div class="bg-white rounded-xl md:rounded-2xl p-4 shadow-lg border border-orange-200 text-center">
                    <div class="text-xl md:text-3xl font-bold gradient-text" id="totalBuyers">0</div>
                    <div class="text-xs md:text-gray-600">Total Buyers</div>
                </div>
                <div class="bg-white rounded-xl md:rounded-2xl p-4 shadow-lg border border-orange-200 text-center">
                    <div class="text-xl md:text-3xl font-bold gradient-text" id="currentPrice">250K</div>
                    <div class="text-xs md:text-gray-600">Tokens per SOL</div>
                </div>
                <div class="bg-white rounded-xl md:rounded-2xl p-4 shadow-lg border border-orange-200 text-center">
                    <div class="text-xl md:text-3xl font-bold gradient-text">1K</div>
                    <div class="text-xs md:text-gray-600">Hard Cap (SOL)</div>
                </div>
            </div>

            <!-- Main Presale Card -->
            <div id="presale" class="max-w-2xl mx-auto bg-white rounded-2xl md:rounded-3xl shadow-xl md:shadow-2xl border-2 border-orange-300 overflow-hidden mb-12 md:mb-16">
                <div class="gradient-bg p-4 md:p-6 text-white">
                    <div class="absolute top-3 right-3 md:top-4 md:right-4">
                        <span class="bg-white/20 px-2 py-1 md:px-3 md:py-1 rounded-full text-xs md:text-sm">ðŸ”¥ LIVE</span>
                    </div>
                    <h2 class="text-xl md:text-3xl font-bold text-center">$ROOFY Presale</h2>
                    <p class="text-center opacity-90 mt-1 md:mt-2 text-sm md:text-base">Hard Cap: 1,000 SOL â€¢ Price increases every tier</p>
                    
                    <!-- Progress Bar -->
                    <div class="mt-4 md:mt-6">
                        <div class="flex justify-between text-xs md:text-sm mb-1 md:mb-2">
                            <span>Progress</span>
                            <span id="progressPercent">0%</span>
                        </div>
                        <div class="h-2 md:h-3 bg-white/30 rounded-full overflow-hidden">
                            <div id="progressBar" class="h-full bg-white rounded-full transition-all duration-1000" style="width: 0%"></div>
                        </div>
                        <div class="flex justify-between text-xs mt-1 md:mt-2">
                            <span>0 SOL</span>
                            <span id="currentRaised">0 SOL</span>
                            <span>1,000 SOL</span>
                        </div>
                    </div>
                </div>

                <div class="p-4 md:p-6 lg:p-8">
                    <!-- Mobile Wallet Instructions -->
                    <div id="mobileWalletHelp" class="mb-4 p-3 bg-blue-50 rounded-xl border border-blue-200 text-sm hidden">
                        <p class="text-blue-700"><i class="fas fa-mobile-alt mr-2"></i>For best mobile experience:</p>
                        <div class="mt-2 space-y-2">
                            <button id="openInPhantom" class="phantom-deep-link w-full text-center">
                                <i class="fas fa-external-link-alt mr-2"></i>Open in Phantom App
                            </button>
                            <button id="installPhantom" class="bg-gradient-to-r from-purple-500 to-pink-500 text-white py-2 px-4 rounded-lg w-full text-center">
                                <i class="fas fa-download mr-2"></i>Install Phantom
                            </button>
                        </div>
                    </div>

                    <!-- Connection Status -->
                    <div id="walletStatus" class="mb-4 md:mb-6 p-3 md:p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl text-center border border-amber-200">
                        <p class="text-amber-700 text-sm md:text-base"><i class="fas fa-info-circle mr-2"></i>Connect wallet to participate</p>
                    </div>

                    <!-- Wallet Info -->
                    <div id="walletInfo" class="hidden mb-4 md:mb-6 p-3 md:p-4 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
                        <div class="flex justify-between items-center">
                            <div class="overflow-hidden">
                                <p class="font-medium text-green-800 text-sm md:text-base"><i class="fas fa-check-circle mr-2"></i>Connected</p>
                                <p id="walletAddress" class="text-xs md:text-sm text-green-600 font-mono truncate"></p>
                                <div id="walletBalance" class="balance-display mt-2 hidden">
                                    <i class="fas fa-coins mr-2"></i>
                                    <span id="balanceAmount">0 SOL</span>
                                </div>
                            </div>
                            <button onclick="disconnectWallet()" class="text-red-600 hover:text-red-800 ml-2">
                                <i class="fas fa-sign-out-alt"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Error Display -->
                    <div id="errorDisplay" class="hidden mb-4">
                        <!-- Error messages will appear here -->
                    </div>

                    <!-- Amount Input -->
                    <div class="mb-4 md:mb-6">
                        <label class="block text-gray-700 mb-2 md:mb-3 font-semibold text-base md:text-lg">
                            <i class="fas fa-coins mr-2"></i>Amount (SOL)
                        </label>
                        <div class="relative">
                            <input type="number" id="amount" value="0.1" min="0.01" step="0.01" 
                                   class="w-full bg-gray-50 border-2 border-orange-300 rounded-xl py-3 md:py-4 px-4 md:px-6 text-xl md:text-2xl font-bold pr-12 md:pr-20 touch-target">
                            <div class="absolute right-4 md:right-6 top-1/2 transform -translate-y-1/2 text-xl md:text-2xl">â—Ž</div>
                        </div>
                        <div class="text-xs md:text-sm text-gray-500 mt-1 md:mt-2">
                            <i class="fas fa-info-circle mr-1"></i> Min: 0.01 SOL â€¢ Max: 100 SOL
                        </div>
                    </div>

                    <!-- Quick Select -->
                    <div class="mb-4 md:mb-6">
                        <div class="text-xs md:text-sm text-gray-600 mb-2 md:mb-3"><i class="fas fa-bolt mr-2"></i>Quick select:</div>
                        <div class="grid grid-cols-3 md:grid-cols-5 gap-2">
                            <button class="quick-amount py-2 md:py-3 bg-gray-100 hover:bg-orange-100 border border-gray-300 hover:border-orange-400 rounded-lg transition-colors touch-target" data-amount="0.1">0.1</button>
                            <button class="quick-amount py-2 md:py-3 bg-gray-100 hover:bg-orange-100 border border-gray-300 hover:border-orange-400 rounded-lg transition-colors touch-target" data-amount="0.5">0.5</button>
                            <button class="quick-amount py-2 md:py-3 bg-gray-100 hover:bg-orange-100 border border-gray-300 hover:border-orange-400 rounded-lg transition-colors touch-target" data-amount="1">1</button>
                            <button class="quick-amount py-2 md:py-3 bg-gray-100 hover:bg-orange-100 border border-gray-300 hover:border-orange-400 rounded-lg touch-target mobile-hidden md:block" data-amount="2">2</button>
                            <button class="quick-amount py-2 md:py-3 bg-gray-100 hover:bg-orange-100 border border-gray-300 hover:border-orange-400 rounded-lg touch-target mobile-hidden md:block" data-amount="5">5</button>
                        </div>
                    </div>

                    <!-- Referral Code -->
                    <div class="mb-4 md:mb-6">
                        <label class="block text-gray-700 mb-2 md:mb-3 font-semibold text-sm md:text-base">
                            <i class="fas fa-user-friends mr-2"></i>Referral Code (5% Bonus!)
                        </label>
                        <div class="relative">
                            <input type="text" id="referralCode" 
                                   class="w-full border-2 border-purple-300 rounded-xl py-2 md:py-3 px-3 md:px-4 pr-24 md:pr-32 touch-target" 
                                   placeholder="ROOFY code">
                            <div class="absolute right-2 md:right-3 top-1/2 transform -translate-y-1/2">
                                <span class="px-2 py-1 md:px-3 md:py-1 bg-purple-100 text-purple-800 rounded-full text-xs md:text-sm font-medium">+5%</span>
                            </div>
                        </div>
                    </div>

                    <!-- Tokens Display -->
                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 rounded-xl p-4 md:p-6 mb-4 md:mb-6 border border-orange-200">
                        <div class="space-y-2 md:space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700 text-sm md:text-base">Base tokens:</span>
                                <span class="font-bold text-base md:text-lg" id="baseTokens">0</span>
                            </div>
                            <div class="flex justify-between items-center text-green-600 hidden" id="bonusSection">
                                <span class="text-sm md:text-base">Bonus (5%):</span>
                                <span class="font-bold text-base md:text-lg" id="bonusTokens">0</span>
                            </div>
                            <div class="border-t border-orange-300 pt-2 md:pt-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-semibold text-base md:text-lg">Total receive:</div>
                                        <div class="text-xs md:text-sm text-gray-600">Airdropped after presale</div>
                                    </div>
                                    <div class="text-right">
                                        <div id="totalTokens" class="text-xl md:text-3xl font-bold text-orange-600">0</div>
                                        <div class="text-xs md:text-sm">ROOFY tokens</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Buy Button -->
                    <button id="buyButton" 
                            class="w-full gradient-bg text-white py-3 md:py-5 rounded-xl text-base md:text-xl font-bold hover:opacity-90 transition-all disabled:opacity-50 touch-target"
                            disabled>
                        <i class="fas fa-lock mr-2"></i><span id="buyButtonText">CONNECT WALLET</span>
                    </button>

                    <!-- Transaction Status -->
                    <div id="transactionStatus" class="mt-3 md:mt-4 hidden">
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-3 md:p-4 border border-green-200">
                            <div class="flex items-center">
                                <div class="text-green-500 text-xl md:text-2xl mr-2 md:mr-3">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-green-800 text-sm md:text-base">Transaction Submitted!</p>
                                    <p id="txHash" class="text-xs md:text-sm text-green-500 font-mono mt-1 truncate"></p>
                                    <p class="text-xs text-green-600 mt-1">Tokens will be airdropped after presale ends</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Purchases -->
                    <div class="mt-6 md:mt-8 pt-4 md:pt-6 border-t border-gray-200">
                        <h4 class="font-bold mb-2 md:mb-4 text-base md:text-lg"><i class="fas fa-history mr-2"></i>Recent Purchases</h4>
                        <div id="recentPurchases" class="space-y-2 md:space-y-3 max-h-40 md:max-h-48 overflow-y-auto">
                            <div class="text-center text-gray-500 py-3 md:py-4 text-sm">
                                <i class="fas fa-sync-alt animate-spin mr-2"></i>Loading purchases...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Token Image Gallery Section -->
            <div id="token" class="mt-12 md:mt-16">
                <div class="text-center mb-6 md:mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold mb-3 md:mb-4"> $ROOFY Token & Art</h2>
                    <p class="text-gray-600 text-base md:text-lg max-w-2xl mx-auto">Official token images and community artwork</p>
                </div>

                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 mb-8">
                    <!-- Token Logo -->
                    <div class="token-image-container">
                        <div class="text-center mb-4">
                            <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-certificate mr-1"></i> Official Logo
                            </span>
                        </div>
                        <img src="https://chocolate-solid-skunk-453.mypinata.cloud/ipfs/bafkreigq22tzxessrj6mvdfcgw4xchwxcphvbbblrylwfunr2w63nhq7xq" 
                             alt="Roofy Official Logo" 
                             class="token-image mb-4">
                        <h3 class="font-bold text-lg text-center mb-2">$ROOFY Logo</h3>
                        <p class="text-gray-600 text-sm text-center">The official token logo</p>
                    </div>

                    <!-- Token Art 1 -->
                    <div class="token-image-container">
                        <div class="text-center mb-4">
                            <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-palette mr-1"></i> Community Art
                            </span>
                        </div>
                        <img src="https://chocolate-solid-skunk-453.mypinata.cloud/ipfs/bafkreian65uqi46ycwlu4mpcteeu4ofkgtvhczouetbnz44y4msmjh2cgi" 
                             alt="Roofy Art 1" 
                             class="token-image mb-4">
                        <h3 class="font-bold text-lg text-center mb-2">Roofy & Lily</h3>
                        <p class="text-gray-600 text-sm text-center">Shiba dinosaur with little girl</p>
                    </div>

                    <!-- Token Art 2 -->
                    <div class="token-image-container">
                        <div class="text-center mb-4">
                            <span class="bg-pink-100 text-pink-800 px-3 py-1 rounded-full text-sm font-medium">
                                <i class="fas fa-palette mr-1"></i> Community Art
                            </span>
                        </div>
                        <img src="https://chocolate-solid-skunk-453.mypinata.cloud/ipfs/bafkreidbf3i3qvznsiml6zxiijl2jzd47jhvllo55umz4zm6k3pa36dnp4" 
                             alt="Roofy Art 2" 
                             class="token-image mb-4">
                        <h3 class="font-bold text-lg text-center mb-2">Moon Mission</h3>
                        <p class="text-gray-600 text-sm text-center">Roofy going to the moon</p>
                    </div>
                </div>
            </div>

            <!-- Professional Story Section -->
            <div id="story" class="mt-12 md:mt-16 max-w-5xl mx-auto">
                <div class="text-center mb-8 md:mb-12">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-orange-500 to-red-500 rounded-full mb-4">
                        <i class="fas fa-book-open text-2xl text-white"></i>
                    </div>
                    <h2 class="text-3xl md:text-4xl font-bold mb-4">The Roofy Story</h2>
                    <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                        A heartfelt journey of love, imagination, and eternal memories
                    </p>
                </div>

                <div class="grid md:grid-cols-3 gap-6 md:gap-8 mb-8">
                    <!-- Story Card 1 -->
                    <div class="story-card">
                        <div class="story-icon">
                            <i class="fas fa-dog"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3 text-gray-800">Our Beloved Shiba Rusty</h3>
                        <p class="text-gray-600 mb-4">
                            Rusty was more than just a pet - he was family. A curious, loyal Shiba Inu with 
                            the classic smile that could brighten even the darkest days. His playful spirit 
                            and unwavering loyalty defined our home.
                        </p>
                        <div class="flex items-center text-sm text-orange-600">
                            <i class="fas fa-heart mr-2"></i>
                            <span>The heart of our family</span>
                        </div>
                    </div>

                    <!-- Story Card 2 -->
                    <div class="story-card">
                        <div class="story-icon">
                            <i class="fas fa-child"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3 text-gray-800">Lily's Magical Imagination</h3>
                        <p class="text-gray-600 mb-4">
                            "Look! Rusty turned into ROOFY the dinosaur!" she'd giggle, as our Shiba 
                            proudly wore his makeshift costume. Lily saw magic in the ordinary, transforming 
                            our loyal companion into her prehistoric best friend through pure imagination.
                        </p>
                        <div class="flex items-center text-sm text-orange-600">
                            <i class="fas fa-magic mr-2"></i>
                            <span>Where reality meets imagination</span>
                        </div>
                    </div>

                    <!-- Story Card 3 -->
                    <div class="story-card">
                        <div class="story-icon">
                            <i class="fas fa-sun"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-3 text-gray-800">Sunset Rituals</h3>
                        <p class="text-gray-600 mb-4">
                            Every evening became a magical ritual. As the sun dipped below the horizon, 
                            dino-costume zoomies filled our home with infectious laughter. These golden 
                            moments created memories that would last forever.
                        </p>
                        <div class="flex items-center text-sm text-orange-600">
                            <i class="fas fa-memory mr-2"></i>
                            <span>Timeless memories created</span>
                        </div>
                    </div>
                </div>

                <!-- Timeline Section -->
                <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-6 md:p-8 border border-amber-200 mt-8">
                    <h3 class="text-2xl font-bold mb-6 text-center text-gray-800">The Journey</h3>
                    
                    <div class="story-timeline max-w-2xl mx-auto">
                        <!-- Timeline Item 1 -->
                        <div class="story-item">
                            <div class="bg-white rounded-xl p-5 shadow-sm">
                                <div class="flex items-center mb-3">
                                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-paw text-orange-600"></i>
                                    </div>
                                    <h4 class="font-bold text-lg">The Beginning</h4>
                                </div>
                                <p class="text-gray-600">
                                    Rusty joined our family, bringing endless joy and companionship. 
                                    His Shiba smile became the symbol of our home's happiness.
                                </p>
                            </div>
                        </div>

                        <!-- Timeline Item 2 -->
                        <div class="story-item">
                            <div class="bg-white rounded-xl p-5 shadow-sm">
                                <div class="flex items-center mb-3">
                                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-hat-wizard text-purple-600"></i>
                                    </div>
                                    <h4 class="font-bold text-lg">Magical Transformation</h4>
                                </div>
                                <p class="text-gray-600">
                                    Lily's imagination turned Rusty into "Roofy" the dinosaur. 
                                    What started as playtime became our most cherished tradition.
                                </p>
                            </div>
                        </div>

                        <!-- Timeline Item 3 -->
                        <div class="story-item">
                            <div class="bg-white rounded-xl p-5 shadow-sm">
                                <div class="flex items-center mb-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-infinity text-blue-600"></i>
                                    </div>
                                    <h4 class="font-bold text-lg">Eternal Legacy</h4>
                                </div>
                                <p class="text-gray-600">
                                    Today, Roofy lives forever on Solana - a tribute to love, 
                                    imagination, and the magic that lives in our memories.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quote Section -->
                    <div class="mt-8 text-center">
                        <div class="inline-block bg-gradient-to-r from-orange-100 to-amber-100 px-6 py-4 rounded-xl border-l-4 border-orange-500 max-w-2xl mx-auto">
                            <p class="text-lg italic text-gray-700 mb-2">
                                "For Lily, who saw dinosaurs in every Shiba, and for Rusty, 
                                who was always more than just a dog."
                            </p>
                            <p class="text-sm text-gray-600 font-medium">
                                â€” A memorial token keeping magic alive on the blockchain
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tokenomics with Pie Chart -->
            <div id="tokenomics" class="mt-12 md:mt-16 max-w-4xl mx-auto">
                <div class="bg-white rounded-2xl p-6 md:p-8 shadow-lg border border-orange-200">
                    <h3 class="text-xl md:text-2xl font-bold mb-6 text-center"><i class="fas fa-chart-pie mr-2"></i>Tokenomics</h3>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Pie Chart -->
                        <div>
                            <div class="bg-gray-50 rounded-xl p-4">
                                <canvas id="tokenomicsChart" class="w-full h-64 md:h-80"></canvas>
                            </div>
                        </div>
                        
                        <!-- Distribution Details -->
                        <div>
                            <h4 class="font-bold text-lg mb-4">ðŸ“Š Distribution</h4>
                            <div class="space-y-4">
                                <!-- Presale -->
                                <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-orange-500 rounded-full mr-3"></div>
                                        <div>
                                            <div class="font-semibold">Presale</div>
                                            <div class="text-sm text-gray-600">Early supporters</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold">50%</div>
                                        <div class="text-sm text-gray-600">500M ROOFY</div>
                                    </div>
                                </div>
                                
                                <!-- Liquidity -->
                                <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                        <div>
                                            <div class="font-semibold">Liquidity</div>
                                            <div class="text-sm text-gray-600">DEX liquidity pool</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold">30%</div>
                                        <div class="text-sm text-gray-600">300M ROOFY</div>
                                    </div>
                                </div>
                                
                                <!-- Marketing -->
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                        <div>
                                            <div class="font-semibold">Marketing</div>
                                            <div class="text-sm text-gray-600">Promotions & growth</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold">5%</div>
                                        <div class="text-sm text-gray-600">50M ROOFY</div>
                                    </div>
                                </div>
                                
                                <!-- CEX -->
                                <div class="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-purple-500 rounded-full mr-3"></div>
                                        <div>
                                            <div class="font-semibold">CEX Listings</div>
                                            <div class="text-sm text-gray-600">Centralized exchanges</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold">5%</div>
                                        <div class="text-sm text-gray-600">50M ROOFY</div>
                                    </div>
                                </div>
                                
                                <!-- Lily's Fund -->
                                <div class="flex items-center justify-between p-3 bg-pink-50 rounded-lg">
                                    <div class="flex items-center">
                                        <div class="w-3 h-3 bg-pink-500 rounded-full mr-3"></div>
                                        <div>
                                            <div class="font-semibold">Lily's Fund</div>
                                            <div class="text-sm text-gray-600">Charity & memorial</div>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-bold">10%</div>
                                        <div class="text-sm text-gray-600">100M ROOFY</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Total Supply -->
                            <div class="mt-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="font-bold text-lg">Total Supply</div>
                                        <div class="text-sm text-gray-600">1,000,000,000 ROOFY</div>
                                    </div>
                                    <div class="text-2xl font-bold text-orange-600">1B</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-gray-900 to-black text-white py-8 md:py-12 mt-12 md:mt-16">
        <div class="max-w-6xl mx-auto px-4">
            <div class="grid md:grid-cols-3 gap-6 md:gap-8">
                <div>
                    <div class="flex items-center mb-4 md:mb-6">
                        <img src="https://chocolate-solid-skunk-453.mypinata.cloud/ipfs/bafkreigq22tzxessrj6mvdfcgw4xchwxcphvbbblrylwfunr2w63nhq7xq" alt="Roofy Logo" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <h3 class="text-xl md:text-2xl font-bold">$ROOFY</h3>
                            <p class="text-xs text-gray-400">The Shiba Dino-Dog</p>
                        </div>
                    </div>
                    <p class="text-gray-400 text-sm">
                        A memorial token keeping Lily's magic alive.
                    </p>
                </div>
                
                <div>
                    <h4 class="text-base md:text-lg font-bold mb-3 md:mb-4">Links</h4>
                    <div class="space-y-2">
                        <a href="#presale" class="block text-gray-400 hover:text-white text-sm md:text-base">Presale</a>
                        <a href="#token" class="block text-gray-400 hover:text-white text-sm md:text-base">Token</a>
                        <a href="#story" class="block text-gray-400 hover:text-white text-sm md:text-base">Story</a>
                        <a href="#tokenomics" class="block text-gray-400 hover:text-white text-sm md:text-base">Tokenomics</a>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-base md:text-lg font-bold mb-3 md:mb-4">In Memory</h4>
                    <div class="bg-gray-800/30 rounded-xl p-3 md:p-4">
                        <p class="text-gray-400 text-xs md:text-sm">
                            "For Lily, who saw dinosaurs in every Shiba."
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 md:mt-8 pt-6 md:pt-8 border-t border-gray-800 text-center text-gray-500 text-xs md:text-sm">
                <p>This is a memecoin. Invest responsibly. 10% goes to charity.</p>
            </div>
        </div>
    </footer>

    <script>
        // =============== CONFIGURATION ===============
        const DEV_WALLET = 'BLKj7mTgRa9Fg1vCDqZeNaBSjyekF4xpK72fMWikZYmq';
        
        // FIXED: Increased to 1,000 SOL hard cap
        const PRESALE_CAP = 1000; // 1,000 SOL hard cap
        const MIN_PURCHASE = 0.01;
        const MAX_PURCHASE = 100;
        const REFERRAL_BONUS = 0.05; // 5%
        
        // Tiered pricing for 1,000 SOL cap
        const TIERS = [
            {
                range: [0, 250],        // First 250 SOL
                tokensPerSOL: 300_000,   // 300K per SOL
                name: 'Early Dino',
                bonus: '50% Bonus'
            },
            {
                range: [250, 500],      // Next 250 SOL
                tokensPerSOL: 250_000,   // 250K per SOL
                name: 'Shiba Warrior',
                bonus: '25% Bonus'
            },
            {
                range: [500, 750],      // Next 250 SOL
                tokensPerSOL: 200_000,   // 200K per SOL
                name: 'Dino Pack',
                bonus: 'Base Price'
            },
            {
                range: [750, 1000],     // Last 250 SOL
                tokensPerSOL: 150_000,   // 150K per SOL
                name: 'Community',
                bonus: 'Reduced Price'
            }
        ];

        // =============== STATE ===============
        let wallet = null;
        let publicKey = null;
        let connection = null;
        let totalRaised = 0;
        let recentPurchases = [];
        let isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        let tokenomicsChart = null;
        let transactionTimeout = null;
        let currentBalance = 0;

        // =============== INITIALIZATION ===============
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing Roofy Presale...');
            
            // Mobile detection and help
            if (isMobile) {
                document.getElementById('mobileWalletHelp').classList.remove('hidden');
                
                // Set up mobile-specific buttons
                setupMobileWalletButtons();
            }
            
            // Mobile menu toggle
            document.getElementById('mobileMenu').addEventListener('click', () => {
                const menu = document.getElementById('mobileMenuContent');
                menu.classList.toggle('hidden');
            });
            
            // Check if Phantom is available in browser
            checkPhantomWallet();
            
            // Initialize connection with multiple RPC endpoints
            initializeConnection();

            // Set up event listeners
            setupEventListeners();
            
            // Initialize UI
            updateTokenCalculation();
            simulateLiveStats();
            loadRecentPurchases();
            
            // Initialize tokenomics pie chart
            initializeTokenomicsChart();
        });

        // =============== CONNECTION MANAGEMENT ===============
        function initializeConnection() {
            // Try multiple RPC endpoints for better reliability
            const rpcEndpoints = [
                'https://api.devnet.solana.com',
                'https://devnet.helius-rpc.com/?api-key=default',
                'https://solana-devnet.g.alchemy.com/v2/demo'
            ];
            
            // Try to create connection with first endpoint
            try {
                connection = new solanaWeb3.Connection(
                    rpcEndpoints[0],
                    {
                        commitment: 'confirmed',
                        disableRetryOnRateLimit: false,
                        confirmTransactionInitialTimeout: 20000
                    }
                );
                console.log('Connected to Solana devnet');
            } catch (err) {
                console.error('Failed to initialize connection:', err);
                showError('Failed to connect to Solana network. Please refresh the page.');
            }
        }

        // =============== WALLET DETECTION ===============
        function checkPhantomWallet() {
            // Check for Phantom wallet
            if (window.solana && window.solana.isPhantom) {
                console.log('Phantom wallet detected');
                wallet = window.solana;
                
                // Set up event listeners
                wallet.on('connect', () => {
                    console.log('Wallet connected:', wallet.publicKey.toString());
                    handleWalletConnect(wallet.publicKey);
                });
                
                wallet.on('disconnect', () => {
                    console.log('Wallet disconnected');
                    handleWalletDisconnect();
                });
                
                // Check if already connected
                if (wallet.isConnected) {
                    console.log('Wallet already connected');
                    handleWalletConnect(wallet.publicKey);
                }
                
                // Also check for other wallet providers
                checkOtherWallets();
            } else {
                console.log('Phantom wallet not detected');
                // Check for other wallets
                checkOtherWallets();
            }
        }

        function checkOtherWallets() {
            // Check for other Solana wallets
            if (window.solflare && window.solflare.isSolflare) {
                console.log('Solflare wallet detected');
            }
            if (window.backpack && window.backpack.isBackpack) {
                console.log('Backpack wallet detected');
            }
        }

        // =============== BALANCE CHECKING ===============
        async function updateWalletBalance() {
            if (!publicKey || !connection) {
                console.log('Cannot update balance: no public key or connection');
                return;
            }
            
            try {
                console.log('Fetching balance for:', publicKey);
                const balance = await connection.getBalance(new solanaWeb3.PublicKey(publicKey));
                currentBalance = balance / solanaWeb3.LAMPORTS_PER_SOL;
                console.log('Balance fetched:', currentBalance, 'SOL');
                
                // Update UI
                const balanceDisplay = document.getElementById('walletBalance');
                const balanceAmount = document.getElementById('balanceAmount');
                
                if (balanceDisplay && balanceAmount) {
                    balanceDisplay.classList.remove('hidden');
                    balanceAmount.textContent = `${currentBalance.toFixed(4)} SOL`;
                }
                
                return currentBalance;
            } catch (err) {
                console.error('Error fetching balance:', err);
                showError('Failed to fetch wallet balance. Please try reconnecting.');
                return 0;
            }
        }

        // =============== ERROR HANDLING ===============
        function showError(message, error = null) {
            const errorDisplay = document.getElementById('errorDisplay');
            errorDisplay.classList.remove('hidden');
            errorDisplay.innerHTML = `
                <div class="error-message">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <span class="font-bold">Error</span>
                    </div>
                    <p class="mt-2">${message}</p>
                    ${error ? `<pre class="mt-2 text-xs">${error.toString().substring(0, 150)}...</pre>` : ''}
                    <button onclick="clearError()" class="mt-3 text-sm underline">Dismiss</button>
                </div>
            `;
            
            // Scroll to error
            errorDisplay.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Log error
            console.error('User error:', message, error);
        }

        function clearError() {
            const errorDisplay = document.getElementById('errorDisplay');
            errorDisplay.classList.add('hidden');
            errorDisplay.innerHTML = '';
        }

        // =============== MOBILE WALLET BUTTONS SETUP ===============
        function setupMobileWalletButtons() {
            const openInPhantomBtn = document.getElementById('openInPhantom');
            const installPhantomBtn = document.getElementById('installPhantom');
            
            if (openInPhantomBtn) {
                openInPhantomBtn.addEventListener('click', () => {
                    openInPhantomApp();
                });
            }
            
            if (installPhantomBtn) {
                installPhantomBtn.addEventListener('click', () => {
                    installPhantomWallet();
                });
            }
        }

        // =============== PHANTOM DEEP LINKING ===============
        function openInPhantomApp() {
            const currentUrl = encodeURIComponent(window.location.href);
            let phantomUrl = '';
            
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                phantomUrl = `https://phantom.app/ul/browse/${currentUrl}?ref=${encodeURIComponent('Roofy Presale')}`;
            } else if (/Android/i.test(navigator.userAgent)) {
                phantomUrl = `intent://${window.location.host}${window.location.pathname}#Intent;scheme=https;package=app.phantom;S.browser_fallback_url=https://phantom.app/download;end`;
            } else {
                phantomUrl = `https://phantom.app/ul/browse/${currentUrl}?ref=${encodeURIComponent('Roofy Presale')}`;
            }
            
            window.location.href = phantomUrl;
            
            setTimeout(() => {
                if (document.hasFocus()) {
                    window.open('https://phantom.app/download', '_blank');
                }
            }, 2000);
        }

        function installPhantomWallet() {
            let installUrl = '';
            
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                installUrl = 'https://apps.apple.com/us/app/phantom-solana-wallet/id1598432977';
            } else if (/Android/i.test(navigator.userAgent)) {
                installUrl = 'https://play.google.com/store/apps/details?id=app.phantom';
            } else {
                installUrl = 'https://phantom.app/download';
            }
            
            window.open(installUrl, '_blank');
        }

        // =============== CONNECT WALLET FUNCTION ===============
        async function connectWallet() {
            console.log('Connect wallet clicked');
            
            if (isMobile && (!window.solana || !window.solana.isPhantom)) {
                console.log('Mobile without Phantom - using deep link');
                openInPhantomApp();
                return;
            }
            
            if (!window.solana) {
                console.log('Phantom not installed');
                if (isMobile) {
                    installPhantomWallet();
                } else {
                    showError('Please install Phantom wallet from <a href="https://phantom.app" target="_blank" class="underline">phantom.app</a>');
                }
                return;
            }

            wallet = window.solana;
            
            try {
                console.log('Requesting wallet connection...');
                await wallet.connect();
                console.log('Wallet connection requested');
            } catch (err) {
                console.error('Connection error:', err);
                if (err.code === 4001) {
                    showError('Connection rejected. Please approve the connection in your wallet.');
                } else {
                    showError('Failed to connect wallet. Please try again.', err);
                }
            }
        }

        // =============== WALLET CONNECT/DISCONNECT ===============
        async function handleWalletConnect(publicKeyObj) {
            console.log('Handling wallet connect');
            publicKey = publicKeyObj.toString();
            
            const shortAddress = publicKey.slice(0, 4) + '...' + publicKey.slice(-4);
            document.getElementById('connectWallet').innerHTML = `<i class="fas fa-wallet mr-2"></i>${shortAddress}`;
            document.getElementById('connectWallet').classList.add('wallet-connected');
            document.getElementById('walletStatus').classList.add('hidden');
            document.getElementById('walletInfo').classList.remove('hidden');
            document.getElementById('walletAddress').textContent = shortAddress;
            document.getElementById('buyButton').disabled = false;
            document.getElementById('buyButtonText').textContent = 'BUY ROOFY TOKENS';
            
            // Clear any errors
            clearError();
            
            // Update wallet balance
            try {
                await updateWalletBalance();
                console.log('Balance updated after connect');
            } catch (err) {
                console.error('Failed to update balance after connect:', err);
            }
        }

        function handleWalletDisconnect() {
            console.log('Handling wallet disconnect');
            publicKey = null;
            currentBalance = 0;
            document.getElementById('connectWallet').innerHTML = '<i class="fas fa-wallet mr-2"></i>Connect';
            document.getElementById('connectWallet').classList.remove('wallet-connected');
            document.getElementById('walletStatus').classList.remove('hidden');
            document.getElementById('walletInfo').classList.add('hidden');
            document.getElementById('buyButton').disabled = true;
            document.getElementById('buyButtonText').textContent = 'CONNECT WALLET';
            document.getElementById('transactionStatus').classList.add('hidden');
            clearError();
        }

        // =============== EVENT LISTENERS ===============
        function setupEventListeners() {
            // Connect wallet button
            document.getElementById('connectWallet').addEventListener('click', connectWallet);

            // Quick amount buttons
            document.querySelectorAll('.quick-amount').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('amount').value = btn.dataset.amount;
                    updateTokenCalculation();
                });
            });

            // Input listeners
            document.getElementById('amount').addEventListener('input', updateTokenCalculation);
            document.getElementById('referralCode').addEventListener('input', updateTokenCalculation);
            document.getElementById('buyButton').addEventListener('click', handlePurchase);
        }

        // =============== TOKEN CALCULATION ===============
        function updateTokenCalculation() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const currentTier = getCurrentTier();
            
            document.getElementById('currentPrice').textContent = 
                `${Math.floor(currentTier.tokensPerSOL).toLocaleString()}K`;
            
            const baseTokens = Math.floor(amount * currentTier.tokensPerSOL);
            
            const hasReferral = document.getElementById('referralCode').value.trim().length > 0;
            const bonusTokens = hasReferral ? Math.floor(baseTokens * REFERRAL_BONUS) : 0;
            const totalTokens = baseTokens + bonusTokens;

            document.getElementById('baseTokens').textContent = baseTokens.toLocaleString();
            document.getElementById('totalTokens').textContent = totalTokens.toLocaleString();
            
            if (hasReferral && bonusTokens > 0) {
                document.getElementById('bonusSection').classList.remove('hidden');
                document.getElementById('bonusTokens').textContent = `+${bonusTokens.toLocaleString()}`;
            } else {
                document.getElementById('bonusSection').classList.add('hidden');
            }
        }

        // =============== PURCHASE HANDLING ===============
        async function handlePurchase() {
            console.log('Purchase initiated');
            
            if (!publicKey) {
                showError('Please connect your wallet first');
                return;
            }

            const amount = parseFloat(document.getElementById('amount').value);
            
            if (isNaN(amount) || amount < MIN_PURCHASE) {
                showError(`Minimum purchase is ${MIN_PURCHASE} SOL`);
                return;
            }

            if (amount > MAX_PURCHASE) {
                showError(`Maximum purchase per transaction is ${MAX_PURCHASE} SOL`);
                return;
            }

            if (totalRaised + amount > PRESALE_CAP) {
                showError(`Purchase would exceed hard cap! Maximum remaining: ${(PRESALE_CAP - totalRaised).toFixed(2)} SOL`);
                return;
            }

            const buyButton = document.getElementById('buyButton');
            const originalText = buyButton.innerHTML;
            buyButton.disabled = true;
            buyButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
            
            // Clear any previous errors
            clearError();

            // Update balance before transaction
            try {
                await updateWalletBalance();
                console.log('Current balance before purchase:', currentBalance);
            } catch (err) {
                console.error('Failed to update balance:', err);
                showError('Failed to check wallet balance. Please try again.');
                resetBuyButton(buyButton, originalText);
                return;
            }

            // Check balance
            if (currentBalance < amount * 1.05) { // 5% buffer for fees
                showError(`Insufficient SOL balance. You need at least ${(amount * 1.05).toFixed(3)} SOL (including fees). You have ${currentBalance.toFixed(3)} SOL.`);
                resetBuyButton(buyButton, originalText);
                return;
            }

            // Set timeout for transaction
            if (transactionTimeout) clearTimeout(transactionTimeout);
            transactionTimeout = setTimeout(() => {
                showError('Transaction timed out. Please check your wallet and try again.');
                resetBuyButton(buyButton, originalText);
            }, 60000); // 60 second timeout

            try {
                console.log('Creating transaction for amount:', amount, 'SOL');
                
                // Create transaction
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: new solanaWeb3.PublicKey(publicKey),
                        toPubkey: new solanaWeb3.PublicKey(DEV_WALLET),
                        lamports: Math.floor(amount * solanaWeb3.LAMPORTS_PER_SOL),
                    })
                );

                // Get recent blockhash
                const { blockhash, lastValidBlockHeight } = await connection.getLatestBlockhash('confirmed');
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = new solanaWeb3.PublicKey(publicKey);

                let signature;
                console.log('Signing transaction...');
                
                // Sign and send transaction
                if (isMobile && wallet) {
                    const { signature: sig } = await wallet.signAndSendTransaction(transaction);
                    signature = sig;
                } else {
                    const signedTransaction = await wallet.signTransaction(transaction);
                    signature = await connection.sendRawTransaction(signedTransaction.serialize());
                }
                
                console.log('Transaction sent with signature:', signature);

                // Wait for confirmation
                console.log('Waiting for confirmation...');
                await connection.confirmTransaction({
                    signature,
                    blockhash,
                    lastValidBlockHeight
                }, 'confirmed');
                
                console.log('Transaction confirmed!');

                // Clear timeout since we succeeded
                clearTimeout(transactionTimeout);

                // Show success
                document.getElementById('transactionStatus').classList.remove('hidden');
                document.getElementById('txHash').textContent = `TX: ${signature.slice(0, 8)}...${signature.slice(-8)}`;
                
                // Update presale stats
                totalRaised += amount;
                updateStats();
                
                addRecentPurchase(amount, signature);
                
                const currentTier = getCurrentTier();
                const baseTokens = Math.floor(amount * currentTier.tokensPerSOL);
                const bonus = document.getElementById('referralCode').value.trim() ? 
                    Math.floor(baseTokens * REFERRAL_BONUS) : 0;
                const total = baseTokens + bonus;
                
                showNotification(`âœ… Purchase Successful! ${total.toLocaleString()} ROOFY tokens will be airdropped after presale`, 'success');

                // Update balance after purchase
                setTimeout(() => updateWalletBalance(), 2000);

                // Reset form
                document.getElementById('amount').value = '0.1';
                document.getElementById('referralCode').value = '';
                updateTokenCalculation();

            } catch (err) {
                console.error('Transaction error:', err);
                clearTimeout(transactionTimeout);
                
                let errorMessage = 'Transaction failed. ';
                
                if (err.message?.includes('User rejected')) {
                    errorMessage = 'You rejected the transaction in your wallet.';
                } else if (err.message?.includes('NotConnectedError')) {
                    errorMessage = 'Wallet not connected. Please reconnect your wallet.';
                } else if (err.message?.includes('timeout') || err.message?.includes('Timeout')) {
                    errorMessage = 'Transaction timed out. The network might be busy. Please try again.';
                } else if (err.message?.includes('blockhash')) {
                    errorMessage = 'Network error. Please refresh the page and try again.';
                } else if (err.message?.includes('insufficient funds')) {
                    errorMessage = 'Insufficient funds. Please add SOL to your wallet.';
                } else {
                    errorMessage += 'Please check your wallet and try again.';
                }
                
                showError(errorMessage, err);
            } finally {
                resetBuyButton(buyButton, originalText);
            }
        }

        function resetBuyButton(button, originalText) {
            button.disabled = false;
            button.innerHTML = originalText;
        }

        // =============== TOKENOMICS PIE CHART ===============
        function initializeTokenomicsChart() {
            const ctx = document.getElementById('tokenomicsChart').getContext('2d');
            
            tokenomicsChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Presale (50%)', 'Liquidity (30%)', 'Marketing (5%)', 'CEX (5%)', "Lily's Fund (10%)"],
                    datasets: [{
                        data: [50, 30, 5, 5, 10],
                        backgroundColor: [
                            '#f97316', // Orange
                            '#3b82f6', // Blue
                            '#10b981', // Green
                            '#8b5cf6', // Purple
                            '#ec4899'  // Pink
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    const tokens = Math.round(value / 100 * 1000000000);
                                    
                                    return `${label}: ${percentage}% (${tokens.toLocaleString()} ROOFY)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // =============== COPY TOKEN ADDRESS ===============
        function copyTokenAddress() {
            const message = "Token address will be revealed after presale completion. Stay tuned! ðŸš€";
            navigator.clipboard.writeText(message).then(() => {
                showNotification('Token address info copied to clipboard!', 'success');
            }).catch(err => {
                showNotification('Failed to copy address', 'error');
            });
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-xl shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // =============== TIER FUNCTIONS ===============
        function getCurrentTier() {
            for (const tier of TIERS) {
                if (totalRaised >= tier.range[0] && totalRaised < tier.range[1]) {
                    return tier;
                }
            }
            return TIERS[TIERS.length - 1];
        }

        // =============== STATS UPDATES ===============
        function updateStats() {
            const progress = (totalRaised / PRESALE_CAP) * 100;
            const currentTier = getCurrentTier();
            
            // Update progress bar
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressPercent').textContent = `${progress.toFixed(1)}%`;
            document.getElementById('currentRaised').textContent = `${totalRaised.toFixed(2)} SOL`;
            document.getElementById('totalRaised').textContent = totalRaised.toFixed(2);
            document.getElementById('currentPrice').textContent = 
                `${Math.floor(currentTier.tokensPerSOL).toLocaleString()}K`;
                
            // Update token calculation with new tier if needed
            updateTokenCalculation();
        }

        function simulateLiveStats() {
            totalRaised = 245.67;
            updateStats();
            document.getElementById('totalBuyers').textContent = '124';
            
            // Simulate occasional purchases for demo purposes
            setInterval(() => {
                if (Math.random() > 0.7) {
                    const randomAmount = 0.1 + Math.random() * 5;
                    totalRaised += randomAmount;
                    if (totalRaised > PRESALE_CAP) totalRaised = PRESALE_CAP;
                    updateStats();
                    
                    if (recentPurchases.length < 5) {
                        addRecentPurchase(randomAmount, `sim_${Date.now()}`);
                    }
                }
            }, 10000);
        }

        function addRecentPurchase(amount, txHash) {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const currentTier = getCurrentTier();
            const tokens = Math.floor(amount * currentTier.tokensPerSOL);
            
            recentPurchases.unshift({
                time: timeString,
                amount: amount.toFixed(2),
                tokens: tokens.toLocaleString(),
                tier: currentTier.name.substring(0, 10)
            });
            
            if (recentPurchases.length > 5) {
                recentPurchases.pop();
            }
            
            loadRecentPurchases();
        }

        function loadRecentPurchases() {
            const container = document.getElementById('recentPurchases');
            container.innerHTML = '';
            
            if (recentPurchases.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-4 text-sm">
                        <i class="fas fa-shopping-cart mr-2"></i>No purchases yet
                    </div>
                `;
                return;
            }
            
            recentPurchases.forEach(purchase => {
                const purchaseEl = document.createElement('div');
                purchaseEl.className = 'flex justify-between items-center p-2 hover:bg-orange-50 rounded-lg text-sm';
                purchaseEl.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                        <div>
                            <div class="font-medium">${purchase.time}</div>
                            <div class="text-xs text-gray-500">${purchase.tier}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold">${purchase.amount} SOL</div>
                        <div class="text-xs text-orange-600">${purchase.tokens} ROOFY</div>
                    </div>
                `;
                container.appendChild(purchaseEl);
            });
        }

        // =============== HELPER FUNCTIONS ===============
        function disconnectWallet() {
            if (wallet) {
                wallet.disconnect();
            }
            handleWalletDisconnect();
        }

        updateTokenCalculation();
    </script>
</body>
</html>
